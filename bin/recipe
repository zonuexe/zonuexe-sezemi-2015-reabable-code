#!/usr/bin/env php
<?php

$argv = array_slice($_SERVER['argv'], 1);

list($user_name, $recipe_file, $select_id) = parse_args($argv);
display_recipe($user_name, $recipe_file, $select_id);



function display_recipe($user_name, $recipe_file, $select_id)
{
    is_file($recipe_file) or die('ファイルないよ'.PHP_EOL);

    if (isset($user_name)) {
        echo 'ユーザー名: ', $user_name, PHP_EOL;
    }

    foreach (load_recipe($recipe_file) as $id => $recipe) {
        if ($select_id == 0 || $select_id == $id) {
            echo "{$id}: {$recipe['name']} {$recipe['url']}" . PHP_EOL;
        }
    }
}

/**
 * ファイルからレシピデータを読み込む
 *
 * @param  string  $file レシピファイルのpath
 * @return array[] [$id => $name] の配列
 */
function load_recipe($file)
{
    $recipes = [];
    $file = new SplFileObject($file);
    $current_id = 0;

    foreach ($file as $index => $line) {
        if (strlen($line) < 1) { break; }

        list($name, $url) = explode(' ', trim($line), 2);

        $current_id++;
        $recipes[$current_id] = ['name' => $name, 'url' => $url];
    }

    return $recipes;
}

/**
 * 引数リストを解釈する
 *
 * @param  string[] $argv argvリスト。argv[0]は必ず捨てられる。
 * @return array (string $user_name, string $recipe_file, int $select_id)
 */
function parse_args(array $argv)
{
    $count = count($argv);

    if ($count === 1) {
        return [null, $argv[0], 0];
    } elseif ($count >= 3) {
        return [$argv[0], $argv[1], (int)$argv[2]];
    } elseif (is_numeric($argv[1])) {
        return [null, $argv[0], (int)$argv[1]];
    }

    return [$argv[0], $argv[1], 0];
}
